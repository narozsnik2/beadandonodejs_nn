<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar">

    <div class="offcanvas-header justify-content-between">
      <h4 class="fw-normal text-uppercase fs-6">Kategóriák</h4>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
        <ul class="navbar-nav justify-content-end menu-list list-unstyled d-flex gap-md-3 mb-0">
      
          <!-- Összes kategória -->
          <li class="nav-item border-dashed active">
            <a href="/pizzak" class="nav-link d-flex align-items-center gap-3 text-dark p-2">
                <img src="/images/pizzas.png" alt="Összes kategória" width="30" height="30">
              <span>Összes kategória</span>
            </a>
          </li>
      
          <!-- Dinamikus kategóriák -->
          <% kategorias.forEach(kat => { %>
            <li class="nav-item border-dashed">
              <a href="/kategoria/<%= kat.nev %>" class="nav-link d-flex align-items-center gap-3 text-dark p-2">
                <span>
                    <%= kat.nev.charAt(0).toUpperCase() + kat.nev.slice(1) %>
                  </span>
              </a>
            </li>
          <% }) %>
      
          <!-- Vegetáriánus pizzák -->
          <li class="nav-item border-dashed">
            <button class="btn btn-toggle dropdown-toggle w-100 d-flex justify-content-between align-items-center text-dark p-2"
                    data-bs-toggle="collapse"
                    data-bs-target="#vegetar-collapse">
              <span>Vegetáriánus pizzák</span>
            </button>
          
            <div class="collapse" id="vegetar-collapse">
              <ul class="btn-toggle-nav list-unstyled fw-normal ps-4 pb-2">
                
                <% vegetaris.forEach(vp => { %>
                  <li class="border-bottom py-2">
          
                    <div class="d-flex justify-content-between align-items-center">
                      <a  class="dropdown-item"><%= vp.nev %></a>
          
          
                      <button class="btn btn-sm btn-success add-vega-btn"
                              data-pizzanev="<%= vp.nev %>">
                        +
                      </button>
                    </div>
          
                    <div class="vega-add-panel d-none mt-2 ps-3">
                      <div class="input-group input-group-sm">
                        <input type="number" min="1" value="1" class="form-control vega-qty">
                        <button class="btn btn-primary add-vega-final">Kosárba</button>
                      </div>
                    </div>
          
                  </li>
                <% }) %>
          
              </ul>
            </div>
          </li>

<script>
          document.querySelectorAll('.add-vega-btn').forEach(btn => {
            btn.addEventListener('click', () => {
              const panel = btn.closest('li').querySelector('.vega-add-panel');
              panel.classList.toggle('d-none');
            });
          });
          
          document.querySelectorAll('.add-vega-final').forEach(btn => {
            btn.addEventListener('click', () => {
              const li = btn.closest('li');
              const pizza = li.querySelector('.add-vega-btn').dataset.pizzanev;
              const qty = li.querySelector('.vega-qty').value;
          
              fetch('/kosar/add-ajax', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ pizzanev: pizza, darab: qty })
              })
              .then(r => r.json())
              .then(data => {
                alert(`${pizza} hozzáadva a kosárhoz!`);
          
      
                li.querySelector('.vega-qty').value = 1;
                li.querySelector('.vega-add-panel').classList.add('d-none');
              });
            });
          });
      </script>


        </ul>
      </div>
  </div>