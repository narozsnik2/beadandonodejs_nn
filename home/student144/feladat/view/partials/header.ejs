<header>
    <div class="container-fluid">
      <div class="row py-3 border-bottom">
        
        <div class="col-sm-4 col-lg-2 text-center text-sm-start d-flex gap-3 justify-content-center justify-content-md-start">
          <div class="d-flex align-items-center my-3 my-sm-0">
            <a href="/">
                <img src="/images/pizzas.png" class="img-fluid" style="max-height: 60px;">
              </a>
          </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
            aria-controls="offcanvasNavbar">
            <svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu"></use></svg>
          </button>
        </div>
        
        <div class="col-sm-6 offset-sm-2 offset-md-0 col-lg-4">
          <div class="search-bar row bg-light p-2 rounded-4">
            <div class="col-md-4 d-none d-md-block">
                <select class="form-select border-0 bg-transparent" id="kategoriaSelect">
                    <option value="/pizzak">Válassz kategóriát!</option>
                    <option value="/pizzak">Összes kategória</option>
                    <option value="/kategoria/Apród">Apród</option>
                  <option value="/kategoria/Főnemes">Főnemes</option>
                  <option value="/kategoria/Király">Király</option>
                  <option value="/kategoria/Lovag">Lovag</option>
                  <option value="/kategoria/Vegetáriánus">Vegetáriánus</option>
                </select>
              </div>

              <div class="col-11 col-md-7 position-relative">
                <input type="text" id="pizzaSearch" class="form-control border-0 bg-transparent" placeholder="Pizzák keresése" autocomplete="off">
                <div id="searchResults" class="list-group position-absolute w-100" style="z-index: 1000;"></div>
              </div>
              
              <div id="addToCartContainer" class="d-none" style="margin-top: 60px;">
                <input type="number" id="pizzaQty" value="1" min="1" class="form-control mb-2 w-25 d-inline">
                <button id="addToCartBtn" class="btn btn-primary">Hozzáadom a kosárhoz</button>
              </div>

              
              <script>
            
            
            const input = document.getElementById('pizzaSearch');
const resultsDiv = document.getElementById('searchResults');
const addToCartContainer = document.getElementById('addToCartContainer');
const qtyInput = document.getElementById('pizzaQty');
const addToCartBtn = document.getElementById('addToCartBtn');

let selectedPizza = null;

input.addEventListener('input', function() {
  const query = this.value.trim();
  if (!query) {
    resultsDiv.innerHTML = '';
    addToCartContainer.classList.add('d-none');
    selectedPizza = null;
    return;
  }

  fetch(`/search?q=${encodeURIComponent(query)}`)
    .then(res => res.json())
    .then(data => {
      resultsDiv.innerHTML = '';
      data.forEach(pizza => {
        const item = document.createElement('div');
        item.className = 'list-group-item d-flex justify-content-between align-items-center';

        const nameSpan = document.createElement('span');
        nameSpan.textContent = pizza.nev;
        item.appendChild(nameSpan);

        const controls = document.createElement('div');
        controls.className = 'd-flex align-items-center';

        const minusBtn = document.createElement('button');
        minusBtn.textContent = '−';
        minusBtn.className = 'btn btn-sm btn-secondary me-1';

        const qtySpan = document.createElement('span');
        qtySpan.textContent = '1';
        qtySpan.className = 'mx-1';

        const plusBtn = document.createElement('button');
        plusBtn.textContent = '+';
        plusBtn.className = 'btn btn-sm btn-secondary ms-1';

      
        minusBtn.addEventListener('click', () => {
          let val = parseInt(qtySpan.textContent);
          if (val > 1) qtySpan.textContent = val - 1;
        });
        plusBtn.addEventListener('click', () => {
          let val = parseInt(qtySpan.textContent);
          qtySpan.textContent = val + 1;
        });

        controls.appendChild(minusBtn);
        controls.appendChild(qtySpan);
        controls.appendChild(plusBtn);

        item.appendChild(controls);

        item.addEventListener('click', () => {
          selectedPizza = pizza.nev;
          qtyInput.value = parseInt(qtySpan.textContent);
          addToCartContainer.classList.remove('d-none');
        });

        resultsDiv.appendChild(item);
      });
    });
});


addToCartBtn.addEventListener('click', function() {
  if (!selectedPizza) return alert('Előbb válassz egy pizzát!');

  const darab = parseInt(qtyInput.value);

  fetch('/kosar/add-ajax', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ pizzanev: selectedPizza, darab })
  })
  .then(res => res.json())
  .then(data => {
    alert(`${selectedPizza} hozzáadva a kosárhoz! Összesen: ${data.find(p => p.pizzanev === selectedPizza)?.darab || 0}`);
    qtyInput.value = 1;
    input.value = '';
    addToCartContainer.classList.add('d-none');
    selectedPizza = null;
  });
});
                </script>



            <div class="col-1">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7Z"/></svg>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <ul class="navbar-nav list-unstyled d-flex flex-row gap-3 gap-lg-5 justify-content-center flex-wrap align-items-center mb-0 fw-bold text-uppercase text-dark">
            <li class="nav-item active">
                <a href="/" class="nav-link">Főoldal</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle pe-3" role="button" id="pages" data-bs-toggle="dropdown" aria-expanded="false">Oldalak</a>
              <ul class="dropdown-menu border-0 p-3 rounded-0 shadow" aria-labelledby="pages">
                <li><a href="/about" class="dropdown-item">Rólunk</a></li>
<li><a href="/pizzak" class="dropdown-item">Étlap</a></li>



<li><a href="/contact" class="dropdown-item">Kapcsolat</a></li>

<% if (isAdmin) { %>
    <li><a href="/admin" class="dropdown-item">Admin</a></li>
  <% } %>

              </ul>
            </li>
          </ul>
        </div>
        
        <div class="col-sm-8 col-lg-2 d-flex gap-5 align-items-center justify-content-center justify-content-sm-end">
          <ul class="d-flex justify-content-end list-unstyled m-0">
           



            


            <li>
                <a href="/kosar" class="p-2 mx-1">
                  <svg width="24" height="24"><use xlink:href="#shopping-bag"></use></svg>
                </a>
              </li>
          </ul>
        </div>
        <div style="position: relative; display: inline-block; margin-left: 20px;">
            <a href="#" id="accountBtn">
              <svg width="24" height="24"><use xlink:href="#user"></use></svg>
            </a>
          
            <!-- Dropdown login form -->
            <div id="loginDropdown" style="display: none; position: absolute; right: 0; top: 30px; background: white; border: 1px solid #ccc; padding: 15px; border-radius: 8px; width: 250px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 1000;">
                <% if (!userId) { %>
                  <!-- Vendég: bejelentkezés / regisztráció -->
                  <form id="loginForm">
                    <input type="text" name="username" placeholder="Felhasználónév" class="form-control mb-2" required>
                    <input type="password" name="password" placeholder="Jelszó" class="form-control mb-2" required>
                    <button type="submit" class="btn btn-primary w-100">Bejelentkezés</button>
                  </form>
                  <button id="registerBtn" class="btn btn-secondary w-100">Regisztráció</button>
                <% } else { %>
                  <!-- Bejelentkezett felhasználó -->
                  <p>Üdv, <strong><%= username %></strong>!</p>
                  <a href="/logout" class="btn btn-danger w-100">Kijelentkezés</a>
                <% } %>
              </div>
          </div>

        </div>
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            const accountBtn = document.getElementById('accountBtn');
            const loginDropdown = document.getElementById('loginDropdown');
            const loginForm = document.getElementById('loginForm');
          
            accountBtn.addEventListener('click', (e) => {
              e.preventDefault();
              loginDropdown.style.display = loginDropdown.style.display === 'block' ? 'none' : 'block';
            });
          
            loginForm.addEventListener('submit', async (e) => {
              e.preventDefault();
              const formData = new FormData(loginForm);
              const data = {
                username: formData.get('username'),
                password: formData.get('password')
              };
          
              try {
                const res = await fetch('/login', {
                  method: 'POST',
                  headers: {'Content-Type': 'application/json'},
                  body: JSON.stringify(data)
                });
          
                const text = await res.text();
                alert(text);
          
                if (res.ok) {
                  loginDropdown.style.display = 'none';
                  window.location.reload();
                }
              } catch (err) {
                console.error(err);
                alert("Hiba történt a bejelentkezés során.");
              }
            });



            registerBtn.addEventListener('click', () => {
    window.location.href = '/register'; 
  });

          
            document.addEventListener('click', (e) => {
              if (!accountBtn.contains(e.target) && !loginDropdown.contains(e.target)) {
                loginDropdown.style.display = 'none';
              }
            });
          });


        </script>

      </div>
    </div>
  </header>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const select = document.getElementById("kategoriaSelect");
    
      if (select) {
        select.addEventListener("change", function () {
          const url = this.value;
          if (url && url.trim() !== "") {
            window.location.href = url;
          }
        });
      }
    });
    </script>

    